#!/usr/bin/env
# Start a Redis daemon for this tmux

_inside_tmux() {
  [[ ${TERM} =~ ^screen ]]
  return $?
}

_redis_socket() {
  local socket
  socket=$(tmux show-environment REDIS_SOCKET 2> /dev/null)
  [[ -z ${socket} ]] && return 1
  echo ${socket} | cut -d= -f2-
}

_redis_pid() {
  local pid
  pid=$(tmux show-environment REDIS_PID 2> /dev/null)
  [[ -z ${pid} ]] && return 1
  echo ${pid} | cut -d= -f2-
}

_redis_running() {
  pid=$(_redis_pid)
  [[ -z ${pid} ]] && return 1
  [[ -n $(ps -o pid= -p ${pid}) ]]
  return $?
}

if _inside_tmux && ! _redis_running; then
  echo "should start redis"
fi

# vim: ft=sh
