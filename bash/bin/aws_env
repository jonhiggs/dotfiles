#!/usr/bin/env bash -e
REDIS_SOCKET=$(tmux show-environment REDIS_SOCKET | cut -d= -f2-)
REDIS_CMD="redis-cli -s ${REDIS_SOCKET}"
CACHE_DURATION=$(( 60 * 60 )) # 1h

AWS_DEFAULT_PROFILE=${1:-staging}
AWS_DEFAULT_REGION=$(aws configure get region 2> /dev/null)
AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key 2> /dev/null)
AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id 2> /dev/null)

for var in AWS_DEFAULT_PROFILE AWS_DEFAULT_REGION AWS_SECRET_ACCESS_KEY AWS_ACCESS_KEY_ID; do
  ${REDIS_CMD} set ${var} "${!var}" &> /dev/null
  ${REDIS_CMD} expire ${var} ${CACHE_DURATION} &> /dev/null
done
